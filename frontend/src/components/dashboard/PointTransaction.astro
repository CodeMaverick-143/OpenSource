---
import type { PointTransaction } from "../../lib/types";
import Badge from "../ui/Badge.astro";
import {
    formatDate,
    formatPoints,
    getTransactionTypeColor,
} from "../../lib/utils";

interface Props {
    transaction: PointTransaction;
}

const { transaction } = Astro.props;

const { text: pointsText, colorClass: pointsColor } = formatPoints(
    transaction.points,
);
const typeColorClass = getTransactionTypeColor(
    transaction.transaction_type as any,
);
---

<div class="bg-white border border-gray-200 rounded-lg p-4">
    <div class="flex items-start justify-between">
        <div class="flex-1">
            <div class="flex items-center gap-2 mb-1">
                <span class={`text-xl font-bold ${pointsColor}`}
                    >{pointsText}</span
                >
                <Badge class={typeColorClass} size="sm">
                    {transaction.transaction_type}
                </Badge>
            </div>
            <p class="text-gray-900 font-medium mb-1">{transaction.reason}</p>
            {
                transaction.pr_reference && (
                    <a
                        href={transaction.pr_reference.github_url}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1"
                    >
                        <span>#{transaction.pr_reference.pr_number}</span>
                        <span>â€¢</span>
                        <span>{transaction.pr_reference.title}</span>
                        <svg
                            class="w-3 h-3"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                            />
                        </svg>
                    </a>
                )
            }
        </div>
        <div class="text-sm text-gray-500">
            {formatDate(transaction.created_at)}
        </div>
    </div>
</div>
